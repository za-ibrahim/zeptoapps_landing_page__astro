---
import { Image } from "astro:assets";
import logo from "../assets/logo.avif";
import ArrowAnimatedButton from "./ArrowAnimatedButton.astro";

const allLinks = [
  {
    title: "Home",
    url: "/",
  },
  {
    title: "Shopify Apps",
    urls: [
      {
        target: "_blank",
        title: "Zepto Product Personalizer",
        url: "https://productpersonalizer.com/",
      },
      {
        target: "_blank",
        title: "Zepto Sign Customizer",
        url: "https://zcustomizer.app/",
      },
      {
        target: "_blank",
        title: "BoostlyCart Cart Drawer Upsell",
        url: "https://apps.shopify.com/boostlycart-cart-drawer-upsell",
      },
      {
        target: "_blank",
        title: "PopMan: Popups & Social Proof",
        url: "https://popman.app/",
      },
      {
        target: "_blank",
        title: "InfinSEO: SEO Image Optimizer",
        url: "https://apps.shopify.com/infinseo",
      },
    ],
  },
  // {
  //   title: "Partners",
  //   url: "/partners",
  // },
  // {
  //   title: "Blog",
  //   url: "blogs",
  // },
  // {
  //   title: "Services",
  //   urls: [
  //     {
  //       title: "Custom Shopify App Development",
  //       url: "/services/custom-shopify-app-dev",
  //     },
  //     {
  //       title: "Professional Theme Set-up and Modification",
  //       url: "/services/custom-shopify-theme-dev",
  //     },
  //     { title: "Store Migration", url: "/services/shopify-store-migration" },
  //     { title: "Custom Ecommerce", url: "/services/custom-ecommerce" },
  //   ],
  // },
  {
    title: "Company",
    urls: [
      {
        title: "Contact Us",
        url: "/contact",
        target: "_self",
      },
      {
        title: "About Us",
        url: "/about-us",
        target: "_self",
      },
      {
        title: "Careers",
        url: "https://career.zeptoapps.com/",
        target: "_self",
      },
    ],
  },
];
---

<nav
  class="nav-container text-gray-700 text-md max-h-[calc(100vh-2rem)] shadow-lg bg-white border-2 border-white rounded-xl"
>
  <div class="mx-auto p-2">
    <!-- Mobile and Desktop Header -->
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <div>
        <a href="/">
          <Image src={logo} alt="Zepto Apps Logo" class="w-36 h-auto" />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-5">
        <ul class="flex gap-5">
          {
            allLinks?.map((link) =>
              link?.urls ? (
                <li class="dropdown-container">
                  <div
                    class="links"
                    role="button"
                    tabindex="0"
                    aria-haspopup="true"
                    aria-expanded="false"
                  >
                    {link.title}
                    <span class="parent-menu-dropdown-icon">
                      <svg
                        version="1.1"
                        xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink"
                        x="0px"
                        y="0px"
                        viewBox="0 0 492 492"
                        style="enable-background:new 0 0 492 492;"
                        xml:space="preserve"
                      >
                        <g>
                          <g>
                            <path d="M265.2,390.7l218.9-218.9c5.1-5.1,7.9-11.8,7.9-19s-2.8-14-7.9-19L468,117.5c-10.5-10.5-27.6-10.5-38.1,0L246.1,301.4 L62,117.3c-5.1-5.1-11.8-7.9-19-7.9c-7.2,0-14,2.8-19,7.9L7.9,133.5c-5.1,5.1-7.9,11.8-7.9,19s2.8,14,7.9,19L227,390.7 c5.1,5.1,11.9,7.9,19.1,7.8C253.3,398.5,260.1,395.8,265.2,390.7z" />
                          </g>
                        </g>
                      </svg>
                    </span>
                  </div>
                  <div class="dropdown-menu">
                    <ul>
                      {link.urls.map((subLink) => (
                        <li>
                          <a
                            href={subLink.url}
                            target={subLink?.target ?? "_self"}
                          >
                            {subLink.title}
                          </a>
                        </li>
                      ))}
                    </ul>
                  </div>
                </li>
              ) : (
                <li>
                  <a class="links" href={link.url}>
                    {link.title}
                  </a>
                </li>
              )
            )
          }
        </ul>
      </div>

      <!-- Get a Quote Button -->
      <a href="/#products-showcase" class="hidden lg:block">
        <ArrowAnimatedButton />
      </a>

      <!-- Mobile Menu Button -->
      <button
        class="lg:hidden mobile-menu-button p-2 overflow-y-auto h-full"
        aria-label="Toggle mobile menu"
        aria-expanded="false"
      >
        <svg
          viewBox="-2.5 0 19 19"
          xmlns="http://www.w3.org/2000/svg"
          class="cf-icon-svg"
          ><path
            d="M.789 4.836a1.03 1.03 0 0 1 1.03-1.029h10.363a1.03 1.03 0 1 1 0 2.059H1.818A1.03 1.03 0 0 1 .79 4.836zm12.422 4.347a1.03 1.03 0 0 1-1.03 1.029H1.819a1.03 1.03 0 0 1 0-2.059h10.364a1.03 1.03 0 0 1 1.029 1.03zm0 4.345a1.03 1.03 0 0 1-1.03 1.03H1.819a1.03 1.03 0 1 1 0-2.059h10.364a1.03 1.03 0 0 1 1.029 1.03z"
          ></path></svg
        >
      </button>
    </div>

    <!-- Mobile Navigation Menu -->
    <div class="mobile-menu hidden lg:hidden">
      <ul class="space-y-3">
        {
          allLinks.map((link) =>
            link?.urls ? (
              <li class="mobile-dropdown-container">
                <div class="mobile-links mobile-dropdown-trigger">
                  {link.title}
                  <span class="mobile-dropdown-icon">
                    <svg
                      version="1.1"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 492 492"
                      class="w-4 h-4"
                    >
                      <path d="M265.2,390.7l218.9-218.9c5.1-5.1,7.9-11.8,7.9-19s-2.8-14-7.9-19L468,117.5c-10.5-10.5-27.6-10.5-38.1,0L246.1,301.4 L62,117.3c-5.1-5.1-11.8-7.9-19-7.9c-7.2,0-14,2.8-19,7.9L7.9,133.5c-5.1,5.1-7.9,11.8-7.9,19s2.8,14,7.9,19L227,390.7 c5.1,5.1,11.9,7.9,19.1,7.8C253.3,398.5,260.1,395.8,265.2,390.7z" />
                    </svg>
                  </span>
                </div>
                <div class="mobile-dropdown-menu hidden">
                  <ul class="ml-4 mt-2 space-y-2">
                    {link.urls.map((subLink) => (
                      <li>
                        <a
                          class="mobile-sub-links"
                          href={subLink.url}
                          target="_blank"
                        >
                          {subLink.title}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              </li>
            ) : (
              <li>
                <a class="mobile-links" href={link.url}>
                  {link.title}
                </a>
              </li>
            )
          )
        }
        <li class="pt-3 border-t-2 border-white">
          <a href="#products-showcase">
            <ArrowAnimatedButton />
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<script src="../script/nav.js"></script>

<style>
  @reference '../styles/global.css';

  /* Desktop Navigation Styles */
  .links {
    @apply hover:text-primary font-medium flex items-center justify-center cursor-pointer transition-colors duration-200;
  }

  .parent-menu-dropdown-icon {
    padding-left: 5px;
  }

  svg {
    fill: #4d4d4d;
    height: 0.7em;
    width: auto;
    margin-left: 5px;
    transition: transform 0.3s ease;
  }

  .links:hover svg {
    fill: var(--color-primary);
  }

  .mobile-menu-button svg {
    height: 1.65rem;
    width: auto;
  }

  /* Desktop Dropdown styles */
  .dropdown-container {
    position: relative;
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background: white;
    border: 1px solid rgba(209, 213, 219, 0.5);
    border-radius: 0.75rem;
    box-shadow:
      0 10px 15px -3px rgba(0, 0, 0, 0.1),
      0 4px 6px -2px rgba(0, 0, 0, 0.05);
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 50;
    min-width: 300px;
    margin-top: 8px;
  }

  .dropdown-container:hover .dropdown-menu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .dropdown-container:hover svg {
    transform: rotate(180deg);
  }

  .dropdown-menu ul {
    list-style: none;
    padding: 0.5rem 0;
    margin: 0;
  }

  .dropdown-menu li {
    margin: 0;
  }

  .dropdown-menu a {
    display: block;
    padding: 0.75rem 1rem;
    color: var(--color-text_80);
    text-decoration: none;
    font-weight: 400;
    transition: all 0.2s ease;
    border-radius: 0;
  }

  .dropdown-menu a:hover {
    background-color: --alpha(var(--color-text) / 0.05);
    color: var(--color-primary);
    padding-left: 1.25rem;
  }

  /* Mobile Navigation Styles */
  .mobile-menu-button {
    @apply text-gray-600 hover:text-primary transition-colors duration-200;
  }

  .mobile-links {
    @apply block py-2 px-3 text-gray-700 hover:text-primary font-medium transition-colors duration-200 cursor-pointer;
  }

  .mobile-dropdown-trigger {
    @apply flex items-center justify-between w-full;
  }

  .mobile-dropdown-container {
    @apply w-full;
  }

  .mobile-dropdown-icon {
    @apply transition-transform duration-200;
  }

  .mobile-dropdown-icon svg {
    @apply w-4 h-4 fill-current;
  }

  .mobile-dropdown-menu {
    @apply hidden;
    overflow: hidden;
  }

  .mobile-dropdown-menu:not(.hidden) {
    display: block;
  }

  .mobile-sub-links {
    @apply block py-2 px-3 text-text_70 hover:text-primary transition-colors duration-200;
  }

  /* Rotation utility for mobile dropdown icons */
  .rotate-180 {
    transform: rotate(180deg);
  }

  /* Mobile menu animations */
  .animate-slide-down {
    animation: slideDown 0.3s ease-out forwards;
  }

  .animate-slide-up {
    animation: slideUp 0.3s ease-in forwards;
  }

  @media (max-width: 480px) {
    .mobile-links {
      padding: 0.75rem 1rem;
      font-size: 1rem;
    }

    .mobile-sub-links {
      padding: 0.5rem 1rem;
      font-size: 0.9rem;
    }
  }

  /* Animations */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideUp {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-10px);
    }
  }

  /* Ensure dropdown appears outside the nav container */
  .nav-container {
    /* position: absolute; */
    /* z-index: 50; */
    /* width: 100%; */
    backdrop-filter: blur(30px);
    background-color: rgba(255, 255, 255, 0.623);
  }

  /* Enhanced mobile experience */
  .mobile-menu {
    @apply border-t border-white  mt-4 pt-4 max-h-[calc(100vh-7rem)] !overflow-y-auto;
  }

  .mobile-menu::-webkit-scrollbar {
    width: 0;
  }

  /* Logo responsive sizing */
  @media (max-width: 640px) {
    .mobile-menu {
      margin-top: 0.75rem;
      padding-top: 0.75rem;
    }
  }
</style>
